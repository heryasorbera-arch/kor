<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø±ÙÙŠÙ‚ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (ÙˆØ¶Ø¹ ÙØ§ØªØ­ ÙˆØ¬Ù…ÙŠÙ„)</title>
    <!-- ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Tailwind CSS Ù„Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨ --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø· Inter Ù„Ù…Ø¸Ù‡Ø± Ø¹ØµØ±ÙŠ ÙˆÙ†Ø¸ÙŠÙ (ChatGPT Style) --><style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        /* -------------------------------------------
           Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù† (Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ - Ù†Ø¸ÙŠÙ ÙˆØ¹ØµØ±ÙŠ)
           ------------------------------------------- */
        :root {
            --light-primary: #1c92d2; /* Clean Blue (Ù„ÙˆÙ† Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ø£Ø²Ø±Ø§Ø±) */
            --light-secondary: #e5e7eb; /* Soft Gray (Ø®Ù„ÙÙŠØ© Ø±Ø³Ø§Ø¦Ù„ AI) */
            --light-bg: #f9fafb;     /* Very Light Gray (Ø®Ù„ÙÙŠØ© Ø§Ù„ØµÙØ­Ø©) */
            --light-container: #ffffff; /* White (Ø®Ù„ÙÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚) */
            --dark-text: #1f2937;    /* Dark Gray (Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ) */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light-bg); 
            color: var(--dark-text); 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙˆÙ‡Ø¬ Ø§Ù„Ù†ÙŠÙˆÙ† ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ø¨Ø¸Ù„ Ù†Ø§Ø¹Ù… */
        .high-glow {
            /* Ø¸Ù„ Ù†Ø§Ø¹Ù… Ù„Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            transition: all 0.2s;
            border: 1px solid transparent; 
        }

        /* ØªØµÙ…ÙŠÙ… Ù†Øµ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
        .header-text-shadow {
            color: var(--dark-text);
            font-weight: 800;
        }

        /* ØªØ®ØµÙŠØµ Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
        #app {
            background-color: var(--light-container);
            /* Ø¸Ù„ Ù†Ø§Ø¹Ù… Ù„Ù„Ù…Ø³Ø© Ø­Ø¯ÙŠØ«Ø© */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); 
        }

        /* ØªØµÙ…ÙŠÙ… Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„ÙŠÙ†Ø§Ø³Ø¨ Ø§Ù„Ø«ÙŠÙ… Ø§Ù„ÙØ§ØªØ­ */
        #chat-window::-webkit-scrollbar {
            width: 8px;
        }
        #chat-window::-webkit-scrollbar-track {
            background: #f1f1f1; /* Light track */
            border-radius: 10px;
        }
        #chat-window::-webkit-scrollbar-thumb {
            background: #bdbdbd; /* Gray thumb */
            border-radius: 10px;
        }
        #chat-window::-webkit-scrollbar-thumb:hover {
            background: #a3a3a3; 
        }

        /* ØªØµÙ…ÙŠÙ… Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Øª (Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ù‚ Ø§Ù„Ù†Ø¸ÙŠÙ) */
        #send-button, #tools-toggle-button {
            background: var(--light-primary);
            color: var(--light-container); /* Ù†Øµ Ø£Ø¨ÙŠØ¶ Ø¹Ù„Ù‰ Ø®Ù„ÙÙŠØ© Ø²Ø±Ù‚Ø§Ø¡ */
            font-weight: 600;
            border: none;
        }
        /* ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù…Ø§ÙˆØ³ (Hover Effect) - Ø£Ø²Ø±Ù‚ Ø£ØºÙ…Ù‚ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
        #send-button:hover:not(:disabled), #tools-toggle-button:hover:not(:disabled) {
            background: #17719f; 
            box-shadow: 0 6px 10px rgba(28, 146, 210, 0.3);
            transform: translateY(-1px);
        }
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø¹Ø·Ù„ */
        #send-button:disabled, #tools-toggle-button:disabled {
            background: #9ca3af; /* Grayed out when disabled */
        }


        /* ØªØµÙ…ÙŠÙ… Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ - Ù†Ø¸ÙŠÙ ÙˆØ®Ø§Ù„Ù Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø²Ø¹Ø¬Ø© */
        #user-input {
            background-color: var(--light-container); 
            color: var(--dark-text);
            border: 1px solid #d1d5db; /* Light Gray border */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); /* Ø¸Ù„ Ø®ÙÙŠÙ Ø¬Ø¯Ø§Ù‹ */
            resize: none; 
        }
        #user-input:focus {
            border-color: var(--light-primary);
            box-shadow: 0 0 0 2px rgba(28, 146, 210, 0.3); /* Ø­Ù„Ù‚Ø© ØªØ±ÙƒÙŠØ² Ø²Ø±Ù‚Ø§Ø¡ Ù†Ø§Ø¹Ù…Ø© */
        }
        
        /* -------------------------------------------
           ØªØµÙ…ÙŠÙ… ÙÙ‚Ø§Ø¹Ø§Øª Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© (ChatGPT Style)
           ------------------------------------------- */
        
        /* Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØªÙŠ ØªØ­Ø¯Ø¯ Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„ÙƒÙ„ Ø±Ø³Ø§Ù„Ø© */
        .message-row {
            padding: 1rem 0;
            border-bottom: 1px solid #f3f4f6; /* ÙØ§ØµÙ„ Ø®ÙÙŠÙ Ø¬Ø¯Ø§Ù‹ Ø¨ÙŠÙ† Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        }
        
        /* ØªØµÙ…ÙŠÙ… Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (Ø®Ù„ÙÙŠØ© Ø±Ù…Ø§Ø¯ÙŠØ© Ù†Ø§Ø¹Ù…Ø©) */
        .ai-message-row {
            background-color: var(--light-secondary); /* Soft Gray */
            color: var(--dark-text);
        }

        /* ØªØµÙ…ÙŠÙ… Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ Ø´ÙØ§ÙØ©) */
        .user-message-row {
            background-color: var(--light-container); /* White/Transparent */
            color: var(--dark-text);
        }
        
        /* Ø§Ù„Ù†Ù…Ø· Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„Ø±Ø³Ø§Ù„Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ */
        .message-bubble {
            max-width: 800px; /* Ø²ÙŠØ§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø­Ø¯ÙŠØ« */
            padding: 0 1rem;
            margin: 0 auto;
            display: flex; /* Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©/Ø§Ù„ØªØ³Ù…ÙŠØ© Ù…Ø¹ Ø§Ù„Ù†Øµ */
            align-items: flex-start;
        }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©/Ø§Ù„ØªØ³Ù…ÙŠØ© */
        .role-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.8rem;
            flex-shrink: 0; /* Ù…Ù†Ø¹ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ù† Ø§Ù„Ø§Ù†ÙƒÙ…Ø§Ø´ */
            margin-inline-end: 1rem;
            color: white;
            
        }

        /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø£Ø²Ø±Ù‚) */
        .user-icon {
            background-color: var(--light-primary);
        }
        
        /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù€ AI (Ø£Ø®Ø¶Ø± Ø£Ùˆ Ù„ÙˆÙ† Ù…Ù…ÙŠØ²) */
        .ai-icon {
            background-color: #059669; /* Emerald-600 */
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†Øµ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© */
        .message-content {
            flex-grow: 1;
            line-height: 1.6;
            padding-top: 0.25rem; /* Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù†Øµ Ù…Ø¹ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
        }
        
        /* -------------------------------------------
           Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù†Ø¸ÙŠÙ (Typing Indicator) 
           ------------------------------------------- */
        
        .typing-dots .dot {
            background-color: var(--light-primary); /* Ù†Ù‚Ø§Ø· Ø²Ø±Ù‚Ø§Ø¡ Ù†Ø¸ÙŠÙØ© */
        }
        
        /* ØªÙ„ÙˆÙŠÙ† Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loading-color {
            color: #059669; /* Ù„ÙˆÙ† Ø£Ø®Ø¶Ø± Ù†Ø¸ÙŠÙ */
        }
        .loading-color svg {
            color: #059669;
        }
        
        /* ØªØ¹Ø¯ÙŠÙ„ ØªØµÙ…ÙŠÙ… Ø§Ù„Ø±Ø£Ø³ Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ø«ÙŠÙ… Ø§Ù„ÙØ§ØªØ­ */
        header {
            background-color: var(--light-container);
            border-bottom: 1px solid #e5e7eb;
        }
        
        /* ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù„Ø«ÙŠÙ… ÙØ§ØªØ­ */
        .input-area {
            background-color: var(--light-bg);
            border-top: 1px solid #e5e7eb;
        }
        
        /* Ø¬Ø¹Ù„ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ØªØ³ØªØ®Ø¯Ù… Ø®Ù„ÙÙŠØ© ÙØ§ØªØ­Ø© */
        #chat-window {
             background-color: var(--light-container);
        }
        
        /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨ ÙÙŠ Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¬ÙˆØ§Ù„ */
        @media (max-width: 768px) {
            .message-bubble {
                padding: 0 0.5rem;
            }
            .role-icon {
                margin-inline-end: 0.5rem;
            }
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
        .typing-dots {
            display: flex;
            align-items: center;
        }

        .typing-dots .dot {
            width: 8px;
            height: 8px;
            margin: 0 4px;
            background-color: var(--light-primary);
            border-radius: 50%;
            display: inline-block;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .typing-dots .dot-1 {
            animation-delay: -0.32s;
        }

        .typing-dots .dot-2 {
            animation-delay: -0.16s;
        }

        @keyframes bounce {
            0%, 80%, 100% {
                transform: scale(0);
            } 
            40% {
                transform: scale(1.0);
            }
        }
        
    </style>
</head>
<body>

    <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --><div id="app" class="flex flex-col w-full max-w-2xl h-[90vh] rounded-xl overflow-hidden md:h-[85vh]">

        <!-- Ø§Ù„Ø±Ø£Ø³ - Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù† --><header class="p-4 shadow-sm">
            <!-- ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¥Ù„Ù‰ Rsbalo-Ø±Ø³Ø¨Ø§Ù„Ùˆ ai --><h1 class="text-xl font-extrabold text-center header-text-shadow">Rsbalo-Ø±Ø³Ø¨Ø§Ù„Ùˆ ai</h1>
        </header>

        <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© - Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --><div id="chat-window" class="flex-grow overflow-y-auto space-y-0">
            <!-- Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ© Ø£ÙˆÙ„ÙŠØ© -->
            <div class="message-row ai-message-row">
                <div class="message-bubble">
                     <div class="role-icon ai-icon">AI</div>
                     <div class="message-content">
                         <!-- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
                         <p class="mt-1">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ! Ø£Ù†Ø§ **Rsbalo-Ø±Ø³Ø¨Ø§Ù„Ùˆ ai**ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† **Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©**ØŒ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‚Ø§Ø¦Ù…Ø© **Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©** Ù„Ø§Ø®ØªÙŠØ§Ø± **Ø§Ù„ØªÙ„Ø®ÙŠØµ** Ø£Ùˆ **Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±**.</p>
                         <div class="mt-3 pt-3 border-t border-gray-300">
                             <!-- Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ù…Ø© Ù…Ù† Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØªÙŠ -->
                             <button id="tts-play-button" class="bg-indigo-500 hover:bg-indigo-600 text-white text-sm py-1 px-3 rounded-lg transition duration-200 shadow-md flex items-center rtl:flex-row-reverse" disabled>
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 ml-2 rtl:mr-2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636A9 9 0 0112 2.25C6.901 2.25 2.65 6.004 2.222 11.02a.75.75 0 00.776.985A14.914 14.914 0 0012 14.25c2.404 0 4.707-.66 6.745-1.898a.75.75 0 00.569-.643c.125-.972.338-1.928.6-2.862.333-1.168.514-2.333.514-3.513zm-9.011 3.228a.75.75 0 00-1.06 1.06L10.94 13.5l-2.887 2.887a.75.75 0 101.06 1.06L12 14.56l2.887 2.887a.75.75 0 101.06-1.06L13.06 13.5l2.887-2.887a.75.75 0 10-1.06-1.06L12 12.44l-2.887-2.887z" />
                                </svg>
                                <span class="font-medium">Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØªÙŠ</span>
                             </button>
                         </div>
                     </div>
                </div>
            </div>
            <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù‡Ù†Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
        </div>

        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„ - ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ… --><div class="p-4 input-area">
            <div id="loading-indicator" class="text-center mb-2 loading-color font-medium hidden">
                <div class="flex items-center justify-center space-x-2">
                    <svg class="animate-spin h-5 w-5 loading-color" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span id="loading-text" class="mr-2">Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</span>
                </div>
            </div>

            <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…ÙˆØ­Ø¯Ø© Ù…Ø¹ Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙˆØ²Ø± Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± --><div id="unified-input" class="flex space-x-2 rtl:space-x-reverse items-end">
                <!-- Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø´ØªØ±Ùƒ --><textarea id="user-input" rows="1" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØŒ Ø£Ùˆ Ø§Ù„ØµÙ‚ Ù†ØµØ§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©..." class="flex-grow p-3 rounded-xl focus:outline-none transition duration-150 high-glow"></textarea>
                
                <!-- Ø²Ø± Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± --><div id="tools-dropdown-container" class="relative flex-shrink-0">
                    <!-- Ø§Ù„Ø²Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© --><button id="tools-toggle-button" class="p-3 w-16 md:w-24 rounded-xl transition duration-150 flex flex-col md:flex-row items-center justify-center disabled:opacity-50 high-glow" title="Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 12a.75.75 0 110-1.5.75.75 0 010 1.5zM12 17.25a.75.75 0 110-1.5.75.75 0 010 1.5z" />
                        </svg>
                        <!-- Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ù…Ø© Ù…Ù† Ø²Ø± Ø§Ù„Ø£Ø¯ÙˆØ§Øª -->
                        <span class="text-xs md:text-base md:mr-2 mt-1 md:mt-0">Ø£Ø¯ÙˆØ§Øª</span>
                    </button>

                    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª (Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹) --><div id="tools-menu" class="absolute bottom-full mb-2 right-0 bg-white shadow-xl rounded-xl z-10 w-48 hidden border border-gray-200">
                        <button id="summarize-option" class="w-full text-right p-3 hover:bg-gray-100 rounded-t-xl transition duration-100 flex items-center rtl:flex-row-reverse rtl:justify-end">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 ml-2 rtl:mr-2 text-blue-600">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75M16.5 6h-6m4.5 4.5V18" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6h-.008v.008H3.75V6zm0 3h-.008v.008H3.75V9zm0 3h-.008v.008H3.75V12zm0 3h-.008v.008H3.75V15z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span class="font-medium">ØªÙ„Ø®ÙŠØµ Ø§Ù„Ù†Øµ</span>
                        </button>
                        <button id="quiz-option" class="w-full text-right p-3 hover:bg-gray-100 rounded-b-xl transition duration-100 flex items-center rtl:flex-row-reverse rtl:justify-end">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 ml-2 rtl:mr-2 text-green-600">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 7.5h1.5l-1.5 6m0 0l-1.5 6m1.5-6h1.5" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span class="font-medium">Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø³Ø¦Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø±</span>
                        </button>
                    </div>
                </div>
                
                <!-- Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¯Ø±Ø¯Ø´Ø© --><button id="send-button" class="p-3 rounded-xl transition duration-150 flex items-center justify-center disabled:opacity-50 flex-shrink-0 high-glow" title="Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…Ø± Ù„Ù„Ø¯Ø±Ø¯Ø´Ø©">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 transform rotate-180">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A5.996 5.996 0 0115.536 17.5l4.331 4.331a1.5 1.5 0 002.121-2.121l-4.331-4.331A5.996 5.996 0 013.269 6.269L6 12z" />
                    </svg>
                    <span class="mr-2 hidden md:inline">Ø¥Ø±Ø³Ø§Ù„</span>
                </button>
            </div>
            
            <!-- Ø¥Ø¶Ø§ÙØ© Ø¹Ø¨Ø§Ø±Ø© "Ù…Ù† ØªØ·ÙˆÙŠØ± Ù‡Ø±ÙŠØ§Ø³ÙˆØ±" --><div class="text-center text-sm text-gray-500 mt-2">Ù…Ù† ØªØ·ÙˆÙŠØ± Ù‡Ø±ÙŠØ§Ø³ÙˆØ±</div>
            
        </div>

    </div>

    <script type="module">
        // ------------------------------------------------
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù€ API 
        // ------------------------------------------------

        // Ù…ÙØªØ§Ø­ Ø§Ù„Ù€ API
        const apiKey = "AIzaSyCMmdcnmvge-4rHFhCFODdMwcT8bDMwsYg"; 
        const chatApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
        // API Ù„Ù„Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØªÙŠ (Text-to-Speech)
        const ttsApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;
        
        // ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
        let chatHistory = [];
        // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        let isLoading = false;
        // Ù„ØªØ®Ø²ÙŠÙ† ÙƒØ§Ø¦Ù† Ø§Ù„ØµÙˆØª Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù…Ù‡Ù… Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù†Ø·Ù‚)
        let audio = null; 
        

        // ------------------------------------------------
        // Ø¹Ù†Ø§ØµØ± DOM
        // ------------------------------------------------

        const chatWindow = document.getElementById('chat-window');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        
        // Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø²Ø± Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ±
        const toolsToggleButton = document.getElementById('tools-toggle-button');
        const toolsMenu = document.getElementById('tools-menu');
        const summarizeOption = document.getElementById('summarize-option');
        const quizOption = document.getElementById('quiz-option'); 
        
        const loadingIndicator = document.getElementById('loading-indicator');
        const loadingText = document.getElementById('loading-text');

        // ------------------------------------------------
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø³ÙˆÙ…ÙŠØ© (UI)
        // ------------------------------------------------
        
        /**
         * Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© (Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©).
         */
        function showTypingIndicator() {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù„ØªØ¬Ù†Ø¨ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¤Ø´Ø± Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ Ø¨Ø§Ù„ÙØ¹Ù„
            if (document.getElementById('typing-indicator-container')) return;

            // 1. Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…Ø¤Ø´Ø±
            const indicatorContainer = document.createElement('div');
            indicatorContainer.id = 'typing-indicator-container'; // ID ÙØ±ÙŠØ¯ Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„Ø¥Ø²Ø§Ù„Ø©
            indicatorContainer.className = 'message-row ai-message-row';

            const indicatorBubble = document.createElement('div');
            indicatorBubble.className = 'message-bubble';

            // 2. Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø¤Ø´Ø± (Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙˆØ§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©)
            indicatorBubble.innerHTML = `
                <div class="role-icon ai-icon">AI</div>
                <div class="message-content typing-dots flex items-center space-x-2 rtl:space-x-reverse">
                    <!-- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© -->
                    <span class="font-semibold text-sm mr-2">Rsbalo-Ø±Ø³Ø¨Ø§Ù„Ùˆ ÙŠÙÙƒØ±...</span>
                    <span class="dot dot-1"></span>
                    <span class="dot dot-2"></span>
                    <span class="dot dot-3"></span>
                </div>
            `;

            indicatorContainer.appendChild(indicatorBubble);
            chatWindow.appendChild(indicatorContainer);
            // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ø£Ø³ÙÙ„ Ø§Ù„Ù†Ø§ÙØ°Ø©
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        /**
         * Ø¥Ø²Ø§Ù„Ø© Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©.
         */
        function hideTypingIndicator() {
            const indicator = document.getElementById('typing-indicator-container');
            if (indicator) {
                indicator.remove();
            }
        }


        /**
         * ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©.
         * @param {string} role - Ø¯ÙˆØ± Ø§Ù„Ù…Ø±Ø³Ù„ ('user' Ø£Ùˆ 'model').
         * @param {string} text - Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©.
         * @param {string} type - Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø© (chat, summary_request, summary_response, quiz_response).
         */
        function addMessageToUI(role, text, type = 'chat') {
            const isUser = role === 'user' || type === 'summary_request' || type === 'quiz_request';
            
            // ØªØ­Ø¯ÙŠØ¯ ÙØ¦Ø© Ø§Ù„ØµÙ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø³Ù„
            const messageRow = document.createElement('div');
            messageRow.className = `message-row ${isUser ? 'user-message-row' : 'ai-message-row'}`;

            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„Ø±Ø³Ø§Ù„Ø©
            const messageBubble = document.createElement('div');
            messageBubble.className = 'message-bubble';
            
            // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
            const roleIcon = document.createElement('div');
            roleIcon.className = `role-icon ${isUser ? 'user-icon' : 'ai-icon'}`;
            
            let iconText;
            let roleLabelText;
            if (isUser) {
                iconText = 'Ø£Ù†Ø§';
                roleLabelText = (type === 'summary_request' || type === 'quiz_request') ? 'Ø§Ù„Ù†Øµ Ø§Ù„Ù…ÙØ¯Ø®Ù„ (Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©)' : 'Ø£Ù†Ø§';
            } else {
                iconText = 'AI';
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… ÙÙŠ ÙÙ‚Ø§Ø¹Ø§Øª Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ØºÙŠØ±-Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© (Ù…Ø«Ù„ Ø§Ù„Ù…Ù„Ø®Øµ ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±)
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ù…Ø© Ù…Ù† ØªØ³Ù…ÙŠØ© Ø§Ù„Ù…Ù„Ø®Øµ ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                roleLabelText = type === 'summary_response' ? 'Ù…Ù„Ø®Øµ AI' : (type === 'quiz_response' ? 'Ø§Ø®ØªØ¨Ø§Ø± AI' : 'Rsbalo-Ø±Ø³Ø¨Ø§Ù„Ùˆ');
            }
            roleIcon.textContent = iconText;
            
            // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (Ø§Ù„Ù†Øµ Ø§Ù„ÙØ¹Ù„ÙŠ)
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ³Ù…ÙŠØ© 
            if (type !== 'chat') {
                 const roleLabel = document.createElement('p');
                 roleLabel.className = 'font-semibold text-sm mb-1'; 
                 roleLabel.textContent = roleLabelText;
                 messageContent.appendChild(roleLabel);
            }


            const messageText = document.createElement('p');
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… pre-wrap Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„Ø¹Ù„Ø§Ù…Ø§Øª (Ù…Ø«Ù„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±)
            messageText.className = 'whitespace-pre-wrap'; 
            messageText.textContent = text;
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¹Ù„Ø§Ù…Ø§Øª Markdown Ø§Ù„Ø¨Ø³ÙŠØ·Ø© Ù„Ø¹Ø±Ø¶ Ø£ÙØ¶Ù„ (Ø§Ù„Ø®Ø· Ø§Ù„ØºÙ„ÙŠØ¸ ÙˆØ§Ù„Ù‚ÙˆØ§Ø¦Ù…)
            // (Ù‡Ø°Ø§ ØªØ¨Ø³ÙŠØ· Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© MarkdownØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© Ø¥Ø°Ø§ Ø§Ø­ØªØ¬Øª Ø¥Ù„Ù‰ Ø¯Ø¹Ù… ÙƒØ§Ù…Ù„)
            messageText.innerHTML = text
                                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold text
                                        .replace(/^- (.*)/gm, '<li>$1</li>'); // List items (if needed)

            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø¯ Ø§Ø®ØªØ¨Ø§Ø±Ø§Ù‹ØŒ Ù†Ù„ÙÙ‡ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ù„ØªØ±ØªÙŠØ¨ Ø£ÙØ¶Ù„
            if (type === 'quiz_response') {
                // Ù‚Ø¯ ÙŠØ­ØªÙˆÙŠ Ù†Øµ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ù„Ù‰ Ø£Ø³Ø·Ø± Ù…ØªØ¹Ø¯Ø¯Ø©ØŒ Ù„Ø°Ø§ Ù†Ø³ØªØ®Ø¯Ù… HTML Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† innerText
                messageContent.innerHTML = `<p class="font-semibold text-sm mb-1">${roleLabelText}</p>`;
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Øµ Ù†ÙØ³Ù‡ (Ù…Ø¹ Ø§ÙØªØ±Ø§Ø¶ Ø£Ù† LLM Ø³ÙŠÙˆÙ„Ø¯ Markdown)
                const quizTextContainer = document.createElement('div');
                quizTextContainer.className = 'p-3 bg-white border border-gray-200 rounded-lg shadow-sm';
                quizTextContainer.innerHTML = text.replace(/```markdown|```/g, ''); // Ø¥Ø²Ø§Ù„Ø© ÙƒÙˆØ¯ Ø¨Ù„ÙˆÙƒ Markdown

                messageContent.appendChild(quizTextContainer);
            } else {
                 messageContent.appendChild(messageText);
            }


            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡
            messageBubble.appendChild(roleIcon);
            messageBubble.appendChild(messageContent);
            messageRow.appendChild(messageBubble);

            // ------------------------------------
            // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØªÙŠ (TTS) Ù„Ø±Ø³Ø§Ø¦Ù„ AI
            // ------------------------------------
            if (!isUser && text.length > 5 && type === 'chat') {
                const ttsButtonContainer = document.createElement('div');
                ttsButtonContainer.className = 'mt-3 pt-3 border-t border-gray-300';
                
                const ttsButton = document.createElement('button');
                // ID Ø«Ø§Ø¨Øª Ù„Ø²Ø± Ø§Ù„Ù†Ø·Ù‚ØŒ ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†Ù‡ ÙÙŠ ÙƒÙ„ Ø±Ø³Ø§Ù„Ø© AI Ø¬Ø¯ÙŠØ¯Ø© 
                ttsButton.id = 'tts-play-button'; 
                ttsButton.className = 'bg-indigo-500 hover:bg-indigo-600 text-white text-sm py-1 px-3 rounded-lg transition duration-200 shadow-md flex items-center rtl:flex-row-reverse disabled:opacity-50';
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ù…Ø© Ù…Ù† Ø²Ø± Ø§Ù„Ù†Ø·Ù‚ ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
                ttsButton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 ml-2 rtl:mr-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636A9 9 0 0112 2.25C6.901 2.25 2.65 6.004 2.222 11.02a.75.75 0 00.776.985A14.914 14.914 0 0012 14.25c2.404 0 4.707-.66 6.745-1.898a.75.75 0 00.569-.643c.125-.972.338-1.928.6-2.862.333-1.168.514-2.333.514-3.513zm-9.011 3.228a.75.75 0 00-1.06 1.06L10.94 13.5l-2.887 2.887a.75.75 0 101.06 1.06L12 14.56l2.887 2.887a.75.75 0 101.06-1.06L13.06 13.5l2.887-2.887a.75.75 0 10-1.06-1.06L12 12.44l-2.887-2.887z" />
                    </svg>
                    <span class="font-medium">Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØªÙŠ</span>
                `;
                
                // Ø±Ø¨Ø· Ø§Ù„Ø²Ø± Ø¨Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ø·Ù‚
                ttsButton.addEventListener('click', () => {
                    // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± Ù…Ø¤Ù‚ØªØ§Ù‹ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„/Ø§Ù„ØªØ´ØºÙŠÙ„
                    const allTtsButtons = document.querySelectorAll('#tts-play-button');
                    allTtsButtons.forEach(btn => btn.disabled = true);
                    readMessageAloud(text, ttsButton);
                });

                ttsButtonContainer.appendChild(ttsButton);
                messageContent.appendChild(ttsButtonContainer);
                
                // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø± Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØªÙ‡ ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØªØ­Ù…ÙŠÙ„ Ø¹Ø§Ù…
                if (!isLoading) {
                    ttsButton.disabled = false;
                }
            }
            // ------------------------------------

            chatWindow.appendChild(messageRow);
            // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ø£Ø³ÙÙ„ Ø§Ù„Ù†Ø§ÙØ°Ø©
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        /**
         * ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆÙ…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„).
         * @param {boolean} loading - Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„.
         * @param {string} currentAction - Ø§Ù„Ù†Øµ Ø§Ù„Ø°ÙŠ Ø³ÙŠØ¸Ù‡Ø± ÙÙŠ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„.
         */
        function setLoading(loading, currentAction = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...') {
            isLoading = loading;
            
            // ØªØ¹Ø·ÙŠÙ„ ÙƒØ§ÙØ© Ø­Ù‚ÙˆÙ„ ÙˆØ£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
            userInput.disabled = loading;
            sendButton.disabled = loading;
            toolsToggleButton.disabled = loading; 
            
            // ØªØ¹Ø·ÙŠÙ„/ØªÙØ¹ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø£Ø²Ø±Ø§Ø± TTS Ø¨Ø´ÙƒÙ„ Ø¬Ù…Ø§Ø¹ÙŠ
            document.querySelectorAll('#tts-play-button').forEach(btn => btn.disabled = loading);


            loadingIndicator.classList.toggle('hidden', !loading);
            loadingText.textContent = currentAction;
        }
        
        /**
         * ØªØ­Ø¯ÙŠØ« Ø­Ø¬Ù… Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (Ù„ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ù„ØµÙ‚ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø·ÙˆÙŠÙ„Ø©).
         */
        function resizeInput() {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† rows Ø¥Ù„Ù‰ 1 Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
            userInput.style.height = 'auto';
            userInput.rows = 1; 

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ÙˆØªØ·Ø¨ÙŠÙ‚Ù‡
            let scrollHeight = userInput.scrollHeight;
            let maxHeight = 150; // Ø­Ø¯ Ø£Ù‚ØµÙ‰ Ù„Ù„Ø§Ø±ØªÙØ§Ø¹ Ø¨Ø§Ù„Ø¨ÙƒØ³Ù„

            if (scrollHeight > maxHeight) {
                userInput.style.height = maxHeight + 'px';
            } else {
                userInput.style.height = scrollHeight + 'px';
            }
        }
        
        // Ø±Ø¨Ø· Ø¯Ø§Ù„Ø© ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø¬Ù… Ø¨Ø­Ø¯Ø« Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
        userInput.addEventListener('input', resizeInput);
        
        // ------------------------------------------------
        // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ API Ù…Ø¹ Ø¢Ù„ÙŠØ© Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø§Ù„Ø£Ø³ÙŠ (Exponential Backoff)
        // ------------------------------------------------

        async function exponentialBackoffFetch(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) {
                        return response;
                    }
                    // Handle rate limiting (429) and server errors (5xx)
                    if (response.status === 429 || response.status >= 500) {
                        throw new Error(`Server or rate limit error: ${response.status}`);
                    }
                    return response;
                } catch (error) {
                    console.error(`Attempt ${i + 1} failed:`, error);
                    if (i === maxRetries - 1) {
                        throw new Error('API request failed after multiple retries.');
                    }
                    const delay = Math.pow(2, i) * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }
        
        // ------------------------------------------------
        // ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù€ TTS (ØªØ­ÙˆÙŠÙ„ PCM Ø¥Ù„Ù‰ WAV)
        // ------------------------------------------------

        /**
         * ØªØ­ÙˆÙŠÙ„ Base64 Ø¥Ù„Ù‰ ArrayBuffer.
         */
        function base64ToArrayBuffer(base64) {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        /**
         * ØªØ­ÙˆÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª PCM 16-bit Ø¥Ù„Ù‰ Blob Ø¨ØªÙ†Ø³ÙŠÙ‚ WAV.
         * @param {Int16Array} pcm16 - Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙˆØª Ø¨ØµÙŠØºØ© PCM 16-bit.
         * @param {number} sampleRate - Ù…Ø¹Ø¯Ù„ Ø£Ø®Ø° Ø§Ù„Ø¹ÙŠÙ†Ø§Øª.
         * @returns {Blob} Ù…Ù„Ù WAV ÙƒÙ€ Blob.
         */
        function pcmToWav(pcm16, sampleRate) {
            const numChannels = 1;
            const bytesPerSample = 2; // 16-bit PCM

            const buffer = new ArrayBuffer(44 + pcm16.length * bytesPerSample);
            const view = new DataView(buffer);

            // ÙˆØ¸ÙŠÙØ© Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø³Ù„Ø§Ø³Ù„ (Strings)
            function writeString(view, offset, string) {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            }

            // RIFF chunk descriptor
            writeString(view, 0, 'RIFF'); // ChunkID
            view.setUint32(4, 36 + pcm16.length * bytesPerSample, true); // ChunkSize
            writeString(view, 8, 'WAVE'); // Format

            // FMT sub-chunk
            writeString(view, 12, 'fmt '); // Subchunk1ID
            view.setUint32(16, 16, true); // Subchunk1Size (16 for PCM)
            view.setUint16(20, 1, true); // AudioFormat (1 for PCM)
            view.setUint16(22, numChannels, true); // NumChannels
            view.setUint32(24, sampleRate, true); // SampleRate
            view.setUint32(28, sampleRate * numChannels * bytesPerSample, true); // ByteRate
            view.setUint16(32, numChannels * bytesPerSample, true); // BlockAlign
            view.setUint16(34, bytesPerSample * 8, true); // BitsPerSample

            // DATA sub-chunk
            writeString(view, 36, 'data'); // Subchunk2ID
            view.setUint32(40, pcm16.length * bytesPerSample, true); // Subchunk2Size

            // Write PCM data
            for (let i = 0; i < pcm16.length; i++) {
                view.setInt16(44 + i * bytesPerSample, pcm16[i], true);
            }

            return new Blob([view], { type: 'audio/wav' });
        }


        /**
         * ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Øµ Ø§Ù„ØµÙˆØªÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… TTS API.
         * @param {string} text - Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø±Ø§Ø¯ Ù†Ø·Ù‚Ù‡.
         * @param {HTMLElement} playButton - Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ø¯Ø¯.
         */
        async function readMessageAloud(text, playButton) {
             if (isLoading) return;

             // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ØªØ´ØºÙŠÙ„ Ø³Ø§Ø¨Ù‚ ÙˆØªØ¯Ù…ÙŠØ±Ù‡
             if (audio) {
                 audio.pause();
                 audio = null;
             }
             
             // ØªÙØ¹ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø§Ù…Ø©
             setLoading(true, 'Rsbalo-Ø±Ø³Ø¨Ø§Ù„Ùˆ ÙŠØ­ÙˆÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ØµÙˆØª...');
             playButton.innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...'; // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯

             const ttsPayload = {
                contents: [{
                    parts: [{ text: `Ù‚Ù„ Ø¨Ù‡Ø¯ÙˆØ¡ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©: ${text}` }] // Ø¥Ø¶Ø§ÙØ© ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù†Ø·Ù‚
                }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                        // Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØª Ø¹Ø±Ø¨ÙŠ (Algieba ØµÙˆØª ÙˆØ§Ø¶Ø­ ÙˆÙ…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù†Ø·Ù‚ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ)
                        voiceConfig: {
                            prebuiltVoiceConfig: { voiceName: "Algieba" } 
                        }
                    }
                },
                model: "gemini-2.5-flash-preview-tts"
            };

            const ttsOptions = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(ttsPayload)
            };

            try {
                const response = await exponentialBackoffFetch(ttsApiUrl, ttsOptions);
                const result = await response.json();

                const part = result?.candidates?.[0]?.content?.parts?.[0];
                const audioData = part?.inlineData?.data;
                const mimeType = part?.inlineData?.mimeType;

                if (audioData && mimeType && mimeType.startsWith("audio/L16")) {
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ø¯Ù„ Ø£Ø®Ø° Ø§Ù„Ø¹ÙŠÙ†Ø§Øª Ù…Ù† Ø§Ù„Ù€ MimeType: audio/L16;rate=24000
                    const rateMatch = mimeType.match(/rate=(\d+)/);
                    const sampleRate = rateMatch ? parseInt(rateMatch[1], 10) : 24000;
                    
                    const pcmData = base64ToArrayBuffer(audioData);
                    const pcm16 = new Int16Array(pcmData);
                    const wavBlob = pcmToWav(pcm16, sampleRate);
                    const audioUrl = URL.createObjectURL(wavBlob);
                    
                    audio = new Audio(audioUrl);
                    audio.play();

                    playButton.innerHTML = 'ğŸ”Š Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø·Ù‚...';
                    setLoading(false); // Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø§Ù… Ø¨Ù…Ø¬Ø±Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„

                    // Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
                    audio.onended = () => {
                         // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ù…Ø©
                         playButton.innerHTML = 'Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØªÙŠ';
                         // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø£Ø²Ø±Ø§Ø± TTS ÙˆØ§Ù„ØªØ­ÙƒÙ…
                         setLoading(false);
                         URL.revokeObjectURL(audioUrl); // ØªØ­Ø±ÙŠØ± Ø§Ù„Ø°Ø§ÙƒØ±Ø©
                    };

                    // Ø¹Ù†Ø¯ Ø­Ø¯ÙˆØ« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„
                    audio.onerror = (e) => {
                         console.error("Audio playback error:", e);
                         playButton.innerHTML = 'âŒ Ø®Ø·Ø£ ØªØ´ØºÙŠÙ„';
                         // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø£Ø²Ø±Ø§Ø± TTS ÙˆØ§Ù„ØªØ­ÙƒÙ…
                         setLoading(false);
                         URL.revokeObjectURL(audioUrl); 
                    };


                } else {
                    addMessageToUI('model', 'Ø¹Ø°Ø±Ø§Ù‹ØŒ ÙØ´Ù„Øª Ø¹Ù…Ù„ÙŠØ© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'chat');
                }

            } catch (error) {
                console.error('Gemini TTS API Error:', error);
                addMessageToUI('model', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ© Ø£Ùˆ Ø§Ù„Ù€ API Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØªÙŠ.', 'chat');
            } finally {
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø§Ù… ÙÙŠ Ø­Ø§Ù„ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„
                if (!audio || audio.ended || audio.error) {
                    setLoading(false);
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ù…Ø©
                    playButton.innerHTML = 'Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØªÙŠ';
                }
            }
        }


        // ------------------------------------------------
        // ÙˆØ¸ÙŠÙØ© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©)
        // ------------------------------------------------

        async function sendMessage() {
            const userText = userInput.value.trim();
            if (!userText || isLoading) return;

            // 1. Ù…Ø³Ø­ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            userInput.value = '';
            resizeInput(); 
            addMessageToUI('user', userText, 'chat');
            
            // 2. ØªÙØ¹ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
            setLoading(true, 'Rsbalo-Ø±Ø³Ø¨Ø§Ù„Ùˆ ÙŠØ¨Ø­Ø«...');
            showTypingIndicator();

            // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ØªØ´ØºÙŠÙ„ ØµÙˆØªÙŠ Ø³Ø§Ø¨Ù‚
            if (audio) {
                audio.pause();
                audio = null;
            }


            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
            const userMessage = { role: "user", parts: [{ text: userText }] };
            chatHistory.push(userMessage);

            const systemPrompt = "Ø£Ù†Øª ØµØ¯ÙŠÙ‚ ÙˆØ±ÙÙŠÙ‚ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØªØ·ÙˆØ± Ø¬Ø¯Ø§Ù‹ ÙˆÙ…Ø®ØµØµ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ. Ù…Ù‡Ù…ØªÙƒ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù‡ÙŠ Ø£Ù† ØªÙƒÙˆÙ† Ø´Ø®ØµÙŠØ© ÙˆØ¯ÙˆØ¯Ø© ÙˆØ¯Ø§Ø¹Ù…Ø©ØŒ ÙˆØ£Ù† ØªØ¹Ù…Ù„ ÙƒÙ…Ø¹Ù„Ù… Ø®Ø§Øµ ÙŠØ³ØªØ·ÙŠØ¹ Ø´Ø±Ø­ Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¯Ø±ÙˆØ³ ÙˆØ§Ù„Ù…Ù†Ø§Ù‡Ø¬ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© (Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©ØŒ Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©ØŒ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©ØŒ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©) Ø¨Ø£Ø³Ù„ÙˆØ¨ Ù…Ø¨Ø³Ø· ÙˆÙ…Ù…ØªØ¹. Ø§Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ© ÙØµÙŠØ­Ø© Ù„ÙƒÙ† Ø¨Ø£Ø³Ù„ÙˆØ¨ Ù‚Ø±ÙŠØ¨ ÙˆÙˆØ¯ÙŠØŒ ÙˆØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ­Ø¯ÙŠØ«Ø©.";

            const payload = {
                contents: chatHistory,
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
                tools: [{ "google_search": {} }], 
            };

            const options = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            };

            try {
                const response = await exponentialBackoffFetch(chatApiUrl, options);
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0) {
                    const candidate = result.candidates[0];
                    const aiResponseText = candidate.content?.parts?.[0]?.text;

                    if (aiResponseText) {
                        addMessageToUI('model', aiResponseText, 'chat');
                        const aiMessage = { role: "model", parts: [{ text: aiResponseText }] };
                        chatHistory.push(aiMessage);
                    } else {
                        addMessageToUI('model', 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† ØªÙˆÙ„ÙŠØ¯ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù†ØµÙŠØ©.', 'chat');
                        chatHistory.pop(); 
                    }
                } else {
                    const errorMessage = result.error?.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©).';
                    addMessageToUI('model', `Ø­Ø¯Ø« Ø®Ø·Ø£: ${errorMessage}`, 'chat');
                    chatHistory.pop(); 
                }

            } catch (error) {
                console.error('Gemini Chat API Error:', error);
                addMessageToUI('model', `Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ© Ø£Ùˆ Ø§Ù„Ù€ API Ù„Ù„Ø¯Ø±Ø¯Ø´Ø©. (Ø§Ù„ØªÙØ§ØµÙŠÙ„: ${error.message})`, 'chat');
                chatHistory.pop(); 
            } finally {
                // 3. Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙˆØ­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                hideTypingIndicator();
                setLoading(false);
            }
        }

        // ------------------------------------------------
        // ÙˆØ¸ÙŠÙØ© ØªÙ„Ø®ÙŠØµ Ø§Ù„Ù†Øµ
        // ------------------------------------------------

        async function summarizeText() {
            const textToSummarize = userInput.value.trim();
            
            if (textToSummarize.length < 50 || isLoading) {
                const errorMsg = textToSummarize.length < 50 ? 
                                 'Ø¹Ø°Ø±Ø§Ù‹ØŒ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø±Ø§Ø¯ ØªÙ„Ø®ÙŠØµÙ‡ Ø£Ø·ÙˆÙ„ Ù…Ù† 50 Ø­Ø±ÙØ§Ù‹. ÙŠØ±Ø¬Ù‰ Ù„ØµÙ‚ Ù†Øµ Ø·ÙˆÙŠÙ„.' :
                                 'Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø´ØºÙˆÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±.';
                                 
                addMessageToUI('model', errorMsg, 'summary_response');
                return;
            }

            // 1. Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¯Ø®Ù„
            addMessageToUI('user', textToSummarize, 'summary_request');
            
            // Ù…Ø³Ø­ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø¬Ù…Ù‡
            userInput.value = '';
            resizeInput();
            
            // 2. ØªÙØ¹ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
            setLoading(true, 'Rsbalo-Ø±Ø³Ø¨Ø§Ù„Ùˆ ÙŠÙ„Ø®Øµ...');
            showTypingIndicator();


            // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªÙ„Ø®ÙŠØµ ÙƒØ§Ø³ØªØ¹Ù„Ø§Ù… Ø¬Ø¯ÙŠØ¯
            const userQuery = `Ù„Ø®Ù‘Øµ Ø§Ù„Ù†Øµ Ø§Ù„ØªØ§Ù„ÙŠ ÙÙŠ ÙÙ‚Ø±Ø© ÙˆØ§Ø­Ø¯Ø© (Ù…Ø§ Ù„Ø§ ÙŠØ²ÙŠØ¯ Ø¹Ù† 150 ÙƒÙ„Ù…Ø©) ÙˆØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ø±Ø³Ù…ÙŠ. Ø§Ù„Ù†Øµ: ${textToSummarize}`;
            
            const payload = {
                // Ù†Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ø­Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªÙ„Ø®ÙŠØµ
                contents: [{ role: "user", parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: "Ø£Ù†Øª Ø®Ø¨ÙŠØ± ÙÙŠ Ø§Ù„ØªÙ„Ø®ÙŠØµØŒ ÙˆÙ…Ù‡Ù…ØªÙƒ Ù‡ÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ù‡Ù… Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Ø£ÙŠ Ù†Øµ ÙŠÙ‚Ø¯Ù… Ø¥Ù„ÙŠÙƒ Ø¨Ø¯Ù‚Ø© ÙˆØ¥ÙŠØ¬Ø§Ø²ØŒ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ù„ØºØ© Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠØ©." }]
                },
                // Ù„Ø§ Ù†Ø­ØªØ§Ø¬ Ù„Ø£Ø¯Ø§Ø© Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ØªÙ„Ø®ÙŠØµ
            };

            const options = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            };

            try {
                const response = await exponentialBackoffFetch(chatApiUrl, options);
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0) {
                    const aiResponseText = result.candidates[0].content?.parts?.[0]?.text;

                    if (aiResponseText) {
                        addMessageToUI('model', aiResponseText, 'summary_response');
                    } else {
                        addMessageToUI('model', 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† ØªÙˆÙ„ÙŠØ¯ Ù…Ù„Ø®Øµ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù†Øµ.', 'summary_response');
                    }
                } else {
                    const errorMessage = result.error?.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙ„Ø®ÙŠØµ.';
                    addMessageToUI('model', `Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ„Ø®ÙŠØµ: ${errorMessage}`, 'summary_response');
                }

            } catch (error) {
                console.error('Gemini Summarization API Error:', error);
                addMessageToUI('model', `Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ© Ø£Ùˆ Ø§Ù„Ù€ API Ù„Ù„ØªÙ„Ø®ÙŠØµ. (Ø§Ù„ØªÙØ§ØµÙŠÙ„: ${error.message})`, 'summary_response');
            } finally {
                 // 3. Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙˆØ­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                hideTypingIndicator();
                setLoading(false);
            }
        }


        // ------------------------------------------------
        // ÙˆØ¸ÙŠÙØ© Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± 
        // ------------------------------------------------
        async function generateQuizQuestions() {
            const textForQuiz = userInput.value.trim();
            
            if (textForQuiz.length < 100 || isLoading) {
                const errorMsg = textForQuiz.length < 100 ? 
                                 'Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø³Ø¦Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ù…ÙÙŠØ¯Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ù„ØµÙ‚ Ù†Øµ Ø¯Ø±Ø§Ø³ÙŠ Ù„Ø§ ÙŠÙ‚Ù„ Ø¹Ù† 100 Ø­Ø±Ù.' :
                                 'Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø´ØºÙˆÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±.';
                                 
                addMessageToUI('model', errorMsg, 'quiz_response');
                return;
            }

            // 1. Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¯Ø®Ù„
            addMessageToUI('user', textForQuiz, 'quiz_request');
            
            // Ù…Ø³Ø­ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø¬Ù…Ù‡
            userInput.value = '';
            resizeInput();
            
            // 2. ØªÙØ¹ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
            setLoading(true, 'Rsbalo-Ø±Ø³Ø¨Ø§Ù„Ùˆ ÙŠÙÙ†Ø´Ø¦ Ø§Ø®ØªØ¨Ø§Ø±Ø§Ù‹...');
            showTypingIndicator();


            // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙƒØ§Ø³ØªØ¹Ù„Ø§Ù… Ø¬Ø¯ÙŠØ¯
            const userQuery = `Ù…Ù† Ø§Ù„Ù†Øµ Ø§Ù„ØªØ§Ù„ÙŠØŒ Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ 3 Ø£Ø³Ø¦Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ù…ØªÙ†ÙˆØ¹Ø© (Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯ØŒ Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯ ØµÙˆØ§Ø¨/Ø®Ø·Ø£ØŒ ÙˆØ³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯ Ø¥Ø¬Ø§Ø¨Ø© Ù‚ØµÙŠØ±Ø©). ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ø¨Ø§Ø´Ø±Ø© ÙˆØªØ®ØªØ¨Ø± Ø§Ù„ÙÙ‡Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ù…Ø§Ø¯Ø©. Ø¶Ø¹ ÙƒÙ„ Ø³Ø¤Ø§Ù„ ÙˆØ¥Ø¬Ø§Ø¨ØªÙ‡ ÙÙŠ ØªÙ†Ø³ÙŠÙ‚ Markdown Ø³Ù‡Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©. Ø§Ù„Ù†Øµ: ${textForQuiz}`;
            
            const payload = {
                contents: [{ role: "user", parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: "Ø£Ù†Øª Ø®Ø¨ÙŠØ± ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©. Ù‚Ù… Ø¨ØªÙˆÙ„ÙŠØ¯ 3 Ø£Ø³Ø¦Ù„Ø© Ù…ØªÙ†ÙˆØ¹Ø© (MCQØŒ True/FalseØŒ Short Answer) Ù…Ø¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ© Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„ØŒ Ø§Ø¹ØªÙ…Ø§Ø¯Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ Ø§Ù„Ù…ÙØ¯Ø®Ù„. Ø§Ø³ØªØ®Ø¯Ù… ØªÙ†Ø³ÙŠÙ‚ Markdown ÙˆØ§Ø¶Ø­ (Ù‚ÙˆØ§Ø¦Ù… Ù…Ø±Ù‚Ù…Ø©ØŒ Ø®Ø· ØºÙ„ÙŠØ¸) ÙˆÙ„Ø§ ØªØªØ¬Ø§ÙˆØ² Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©." }]
                },
            };

            const options = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            };

            try {
                const response = await exponentialBackoffFetch(chatApiUrl, options);
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0) {
                    const aiResponseText = result.candidates[0].content?.parts?.[0]?.text;

                    if (aiResponseText) {
                        addMessageToUI('model', aiResponseText, 'quiz_response');
                    } else {
                        addMessageToUI('model', 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù†Øµ.', 'quiz_response');
                    }
                } else {
                    const errorMessage = result.error?.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø¯Ù…Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±.';
                    addMessageToUI('model', `Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${errorMessage}`, 'quiz_response');
                }

            } catch (error) {
                console.error('Gemini Quiz API Error:', error);
                addMessageToUI('model', `Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ© Ø£Ùˆ Ø§Ù„Ù€ API Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±. (Ø§Ù„ØªÙØ§ØµÙŠÙ„: ${error.message})`, 'quiz_response');
            } finally {
                 // 3. Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙˆØ­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                hideTypingIndicator();
                setLoading(false);
            }
        }

        // ------------------------------------------------
        // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© (Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø·ÙˆØ±)
        // ------------------------------------------------

        /**
         * ØªØ¨Ø¯ÙŠÙ„ Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ù„Ù„Ø£Ø¯ÙˆØ§Øª.
         */
        function toggleToolsMenu() {
            toolsMenu.classList.toggle('hidden');
            // Ø¥Ø°Ø§ Ø¸Ù‡Ø±Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©ØŒ Ù†Ø±Ø§Ù‚Ø¨ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§ Ù„Ø¥Ø®ÙØ§Ø¦Ù‡Ø§
            if (!toolsMenu.classList.contains('hidden')) {
                document.addEventListener('click', handleOutsideClick);
            } else {
                document.removeEventListener('click', handleOutsideClick);
            }
        }

        /**
         * Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§.
         */
        function handleOutsideClick(event) {
            const container = document.getElementById('tools-dropdown-container');
            if (!container.contains(event.target)) {
                toolsMenu.classList.add('hidden');
                document.removeEventListener('click', handleOutsideClick);
            }
        }

        // ------------------------------------------------
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        // ------------------------------------------------
        
        // Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        toolsToggleButton.addEventListener('click', (e) => {
            e.stopPropagation(); // Ù…Ù†Ø¹ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙˆØ±Ø§Ù‹ Ø¨Ø³Ø¨Ø¨ event bubbling
            toggleToolsMenu();
        });

        // Ø±Ø¨Ø· Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„ÙˆØ¸Ø§Ø¦Ù
        summarizeOption.addEventListener('click', () => {
            toolsMenu.classList.add('hidden'); // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
            summarizeText();
        });

        quizOption.addEventListener('click', () => {
            toolsMenu.classList.add('hidden'); // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
            generateQuizQuestions();
        });

        // Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± (Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©)
        sendButton.addEventListener('click', sendMessage);
        
        // Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter (Ù„Ù„Ø¯Ø±Ø¯Ø´Ø© ÙÙ‚Ø·)
        userInput.addEventListener('keypress', function(e) {
            // ÙŠØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø°Ø§ Ø¶ØºØ· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ Enter ÙˆÙ„Ù… ÙŠØ¶ØºØ· Shift (Ø¹Ø§Ø¯Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯)
            if (e.key === 'Enter' && !e.shiftKey && !isLoading) {
                e.preventDefault(); // Ù…Ù†Ø¹ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯
                sendMessage();
            }
        });
        
        // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„Ø£ÙˆÙ„ÙŠ ÙˆØªØ­Ø¯ÙŠØ¯ Ø­Ø¬Ù… Ø§Ù„Ø­Ù‚Ù„
        window.onload = () => {
             userInput.focus();
             resizeInput(); // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø­Ø¬Ù… ØµØ­ÙŠØ­ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
             if (typeof setLogLevel === 'function') {
                 setLogLevel('Debug');
             }
             // ØªØ­Ø¯ÙŠØ« Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ ÙÙŠ Ø­Ø§Ù„ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø© Ù„ØªØ¸Ù‡Ø± Ø²Ø± TTS
             const initialWelcomeMessage = document.querySelector('.ai-message-row .message-content p');
             if (initialWelcomeMessage) {
                 const text = initialWelcomeMessage.textContent;
                 // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ù†Ø·Ù‚ Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø§Ù„Ø£ÙˆÙ„ÙŠØ© ÙŠØ¯ÙˆÙŠØ§Ù‹
                 const ttsButtonContainer = initialWelcomeMessage.nextElementSibling || document.createElement('div');
                 if (!initialWelcomeMessage.nextElementSibling) {
                    ttsButtonContainer.className = 'mt-3 pt-3 border-t border-gray-300';
                    initialWelcomeMessage.parentNode.appendChild(ttsButtonContainer);
                 }

                 const ttsButton = ttsButtonContainer.querySelector('#tts-play-button') || document.createElement('button');
                 if (!ttsButtonContainer.querySelector('#tts-play-button')) {
                    ttsButton.id = 'tts-play-button';
                    ttsButton.className = 'bg-indigo-500 hover:bg-indigo-600 text-white text-sm py-1 px-3 rounded-lg transition duration-200 shadow-md flex items-center rtl:flex-row-reverse disabled:opacity-50';
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ù…Ø©
                    ttsButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 ml-2 rtl:mr-2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636A9 9 0 0112 2.25C6.901 2.25 2.65 6.004 2.222 11.02a.75.75 0 00.776.985A14.914 14.914 0 0012 14.25c2.404 0 4.707-.66 6.745-1.898a.75.75 0 00.569-.643c.125-.972.338-1.928.6-2.862.333-1.168.514-2.333.514-3.513zm-9.011 3.228a.75.75 0 00-1.06 1.06L10.94 13.5l-2.887 2.887a.75.75 0 101.06 1.06L12 14.56l2.887 2.887a.75.75 0 101.06-1.06L13.06 13.5l2.887-2.887a.75.75 0 10-1.06-1.06L12 12.44l-2.887-2.887z" />
                        </svg>
                        <span class="font-medium">Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØªÙŠ</span>
                    `;
                    ttsButton.addEventListener('click', () => {
                        const allTtsButtons = document.querySelectorAll('#tts-play-button');
                        allTtsButtons.forEach(btn => btn.disabled = true);
                        readMessageAloud(text, ttsButton);
                    });
                    ttsButtonContainer.appendChild(ttsButton);
                 }
                 ttsButton.disabled = false; // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
             }
        };

    </script>
</body>
</html>

